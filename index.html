<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Playlist MP3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .playlist-item:hover .delete-btn { opacity: 1; }
        .delete-btn { opacity: 0; transition: opacity 0.2s ease-in-out; }
        /* Style untuk progress bar */
        .progress-bar-container { background-color: #4a5568; }
        .progress-bar { background-color: #4fd1c5; transition: width 0.1s linear; }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <!-- Elemen Audio Player yang tersembunyi -->
    <audio id="audioPlayer"></audio>

    <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 w-full max-w-lg">
        
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-cyan-400">MP3 Player</h1>
            <p class="text-gray-400 mt-1">Dibuat dengan Doubly Linked List</p>
        </div>

        <!-- Kontrol Player -->
        <div class="bg-gray-700 rounded-lg p-4 mb-4">
            <div class="text-center mb-3">
                <p class="text-sm text-gray-400">SEDANG DIPUTAR</p>
                <h2 id="nowPlaying" class="text-xl font-semibold truncate h-7">Pilih lagu untuk diputar</h2>
            </div>
            <!-- Progress Bar dan Waktu -->
            <div class="flex items-center gap-3 text-xs text-gray-400 mb-3">
                <span id="currentTime">0:00</span>
                <div class="w-full progress-bar-container rounded-full h-1.5">
                    <div id="progressBar" class="progress-bar h-1.5 rounded-full" style="width: 0%"></div>
                </div>
                <span id="totalDuration">0:00</span>
            </div>
            <div class="flex justify-center items-center gap-6">
                <button id="prevBtn" class="text-gray-400 hover:text-white text-2xl transition-colors"><i class="fas fa-backward-step"></i></button>
                <button id="playBtn" class="bg-cyan-500 hover:bg-cyan-600 text-white rounded-full w-16 h-16 flex items-center justify-center text-3xl transition-transform transform hover:scale-110">
                    <i id="playIcon" class="fas fa-play"></i>
                </button>
                <button id="nextBtn" class="text-gray-400 hover:text-white text-2xl transition-colors"><i class="fas fa-forward-step"></i></button>
            </div>
        </div>

        <!-- Daftar Playlist -->
        <h3 class="text-lg font-semibold mb-2 text-gray-300">Daftar Putar</h3>
        <div id="playlistContainer" class="bg-gray-700 rounded-lg max-h-60 overflow-y-auto">
            <p id="emptyMessage" class="text-gray-500 text-center p-8">Playlist masih kosong.</p>
        </div>

        <!-- Fitur Import -->
        <div class="mt-4 text-center">
            <label for="importFile" class="cursor-pointer bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 inline-block">
                <i class="fas fa-music mr-2"></i> Pilih File MP3
            </label>
            <input type="file" id="importFile" class="hidden" accept=".mp3" multiple>
             <p id="importStatus" class="text-sm text-gray-500 mt-2"></p>
        </div>

    </div>

    <script>
        // --- Implementasi Doubly Linked List ---
        // Node now stores an object with title and URL
        class Node {
            constructor(data) {
                this.data = data; // data = { title: "...", url: "..." }
                this.next = null;
                this.prev = null;
            }
        }

        class DoublyLinkedList {
            constructor() {
                this.head = null;
                this.tail = null;
                this.length = 0;
                this.currentNode = null;
            }

            add(data) {
                const newNode = new Node(data);
                if (this.length === 0) {
                    this.head = newNode;
                    this.tail = newNode;
                } else {
                    this.tail.next = newNode;
                    newNode.prev = this.tail;
                    this.tail = newNode;
                }
                this.length++;
            }

            remove(url) { // Remove by URL as it's unique
                if (!this.head) return;

                let currentNode = this.head;
                while(currentNode) {
                    if (currentNode.data.url === url) {
                        if (this.currentNode === currentNode) {
                            if(currentNode.next) this.currentNode = currentNode.next;
                            else if (currentNode.prev) this.currentNode = currentNode.prev;
                            else this.currentNode = null;
                        }
                        
                        if (currentNode.prev) currentNode.prev.next = currentNode.next;
                        else this.head = currentNode.next;

                        if (currentNode.next) currentNode.next.prev = currentNode.prev;
                        else this.tail = currentNode.prev;
                        
                        // Revoke the Object URL to free up memory
                        URL.revokeObjectURL(currentNode.data.url);
                        this.length--;
                        return true;
                    }
                    currentNode = currentNode.next;
                }
                return false;
            }
        }
        
        // --- Logika Aplikasi ---
        document.addEventListener('DOMContentLoaded', () => {
            const playlist = new DoublyLinkedList();
            
            // DOM Elements
            const audioPlayer = document.getElementById('audioPlayer');
            const playlistContainer = document.getElementById('playlistContainer');
            const emptyMessage = document.getElementById('emptyMessage');
            const nowPlaying = document.getElementById('nowPlaying');
            const playBtn = document.getElementById('playBtn');
            const playIcon = document.getElementById('playIcon');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const importFile = document.getElementById('importFile');
            const importStatus = document.getElementById('importStatus');
            const currentTimeEl = document.getElementById('currentTime');
            const totalDurationEl = document.getElementById('totalDuration');
            const progressBar = document.getElementById('progressBar');

            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            }

            function playSong(node) {
                if (!node) {
                    audioPlayer.pause();
                    nowPlaying.textContent = "Playlist Selesai";
                    playIcon.className = 'fas fa-play';
                    return;
                }
                playlist.currentNode = node;
                audioPlayer.src = node.data.url;
                audioPlayer.play();
                nowPlaying.textContent = node.data.title;
                playIcon.className = 'fas fa-pause';
                renderPlaylist(); // To highlight the current song
            }

            function renderPlaylist() {
                playlistContainer.innerHTML = '';
                if (playlist.length === 0) {
                    playlistContainer.appendChild(emptyMessage);
                    emptyMessage.style.display = 'block';
                    nowPlaying.textContent = 'Pilih lagu untuk diputar';
                    return;
                }
                
                emptyMessage.style.display = 'none';
                let currentNode = playlist.head;
                while(currentNode) {
                    const item = document.createElement('div');
                    const isActive = playlist.currentNode === currentNode;
                    item.className = `playlist-item flex items-center justify-between p-3 border-b border-gray-600 hover:bg-gray-600 transition-colors cursor-pointer ${isActive ? 'bg-cyan-800' : ''}`;
                    item.dataset.songUrl = currentNode.data.url;

                    const title = document.createElement('span');
                    title.className = 'text-white truncate';
                    title.textContent = currentNode.data.title;
                    
                    const deleteButton = document.createElement('button');
    Ã¾                deleteButton.className = 'delete-btn text-red-500 hover:text-red-400 text-lg flex-shrink-0 ml-4';
                    deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                    deleteButton.dataset.songUrl = currentNode.data.url;
                    
                    item.appendChild(title);
                    item.appendChild(deleteButton);
                    playlistContainer.appendChild(item);
                    
                    currentNode = currentNode.next;
                }
            }

            // --- Event Listeners ---
            
            // Player Controls
            playBtn.addEventListener('click', () => {
                if (playlist.length === 0) return;
                
                if (audioPlayer.paused) {
                    if (!playlist.currentNode) {
                        playSong(playlist.head);
                    } else {
                        audioPlayer.play();
                    }
                } else {
                    audioPlayer.pause();
                }
            });

            nextBtn.addEventListener('click', () => {
                if (playlist.currentNode && playlist.currentNode.next) {
                    playSong(playlist.currentNode.next);
                }
            });

            prevBtn.addEventListener('click', () => {
                if (playlist.currentNode && playlist.currentNode.prev) {
                    playSong(playlist.currentNode.prev);
                }
            });

            // Playlist item click
            playlistContainer.addEventListener('click', (e) => {
                const target = e.target;
                
                const deleteButton = target.closest('.delete-btn');
                if (deleteButton) {
                    const songUrl = deleteButton.dataset.songUrl;
                    playlist.remove(songUrl);
                    if (playlist.currentNode && playlist.currentNode.data.url === songUrl) {
                        playSong(playlist.currentNode); // Play the next/prev song
                    }
                    renderPlaylist();
                    return;
                }
                
                const playlistItem = target.closest('.playlist-item');
                if (playlistItem) {
                    const songUrl = playlistItem.dataset.songUrl;
                    let nodeToPlay = playlist.head;
                    while(nodeToPlay) {
                        if (nodeToPlay.data.url === songUrl) {
                            playSong(nodeToPlay);
                            break;
                        }
                        nodeToPlay = nodeToPlay.next;
                    }
                }
            });

            // File Import
            importFile.addEventListener('change', (event) => {
                const files = event.target.files;
                if (!files.length) return;

                let importedCount = 0;
                for (const file of files) {
                    if (file.type === "audio/mpeg") {
                        const songData = {
                            title: file.name.replace('.mp3', ''),
                            url: URL.createObjectURL(file)
                        };
                        playlist.add(songData);
                        importedCount++;
                    }
                }

                if (importedCount > 0) {
                    renderPlaylist();
                    importStatus.textContent = `${importedCount} lagu berhasil diimpor!`;
                } else {
                    importStatus.textContent = 'Tidak ada file MP3 yang valid dipilih.';
                }
                importFile.value = '';
            });
            
            // Audio Player Events
            audioPlayer.addEventListener('play', () => playIcon.className = 'fas fa-pause');
            audioPlayer.addEventListener('pause', () => playIcon.className = 'fas fa-play');
            audioPlayer.addEventListener('ended', () => {
                // Autoplay next song
                if (playlist.currentNode && playlist.currentNode.next) {
                    playSong(playlist.currentNode.next);
                } else {
                     // End of playlist
                     playlist.currentNode = null;
                     renderPlaylist();
                }
            });
            audioPlayer.addEventListener('loadedmetadata', () => {
                totalDurationEl.textContent = formatTime(audioPlayer.duration);
            });
            audioPlayer.addEventListener('timeupdate', () => {
                currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
                const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                progressBar.style.width = `${progress}%`;
            });
            
            renderPlaylist(); // Initial render
        });
    </script>
</body>
</html>

